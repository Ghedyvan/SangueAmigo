<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAfDT48kuTU7b4xrHhlg6F77BM4V_ix7w8&libraries=places"></script>
    <link rel="stylesheet" href="./css/home.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Archivo:wght@400;500;700&family=Poppins:wght@400;500;700&family=Prosto+One&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <header>
      <div class="user">
        <button>
          <div class="text">
            <p>Larissa Santana</p>
            <h2>O+</h2>
          </div>
          <div class="arrow">
            <img src="./img/bloodicon.svg" alt="" />
            <img src="./img/icon/more.svg" alt="" />
          </div>
          <div class="divisor">
            <img src="./img/linetop.svg" alt="" />
          </div>
        </button>
        <a href="./index.html"
          ><button>
            <img src="./img/icon/logout.svg" alt="" /></button
        ></a>
      </div>
    </header>
    <nav>
      <div class="block"></div>
      <div class="icons">
        <a href="./home.html">
          <button>
            <img src="./img/home.svg" alt="" class="imgselected" />
            <img src="./img/homeWhite.svg" alt="" class="imgnotselected" />
          </button>
        </a>
        <a href="./map.html">
          <button class="selected">
            <img src="./img/map.svg" alt="" class="imgnotselected" />
            <img src="./img/mapSelected.svg" alt="" class="imgselected" />
          </button>
        </a>
        <a href="./chart.html">
          <button>
            <img src="./img/line chart.svg" alt="" class="imgnotselected" />
            <img
              src="./img/line chartSelected.svg"
              alt=""
              class="imgselected"
            />
          </button>
        </a>

        <a href="./profile.html">
          <button>
            <img src="./img/userid.svg" alt="" class="imgnotselected" />
            <img src="./img/useridSelected.svg" alt="" class="imgselected" />
          </button>
        </a>

        <a href="./hemocentros.html">
          <button>
            <img src="./img/viewlistlarge.svg" alt="" class="imgnotselected" />
            <img
              src="./img/viewlistlargeSelected.svg"
              alt=""
              class="imgselected"
            />
          </button>
        </a>
      </div>
      <div class="img">
        <img src="./img/gotasidebar.svg" alt="" class="imgnotselected" />
      </div>
    </nav>

    <main>
      <div class="container">
        <div id="map" style="height: 100%; width: 100%"></div>
      </div>
    </main>
  </body>
  <!-- <script>
    // This code will get the user's location and show a map of the nearest blood banks
    var map = new google.maps.Map(document.getElementById("map"), {
      center: new google.maps.LatLng(-9.8018383, -36.1145013),
      zoom: 13,
    });
    
    // Get the user's location
    var geocoder = new google.maps.Geocoder();
    geocoder.geocode({
      address: "57245321",
    }, function(results, status) {
      if (status === google.maps.GeocoderStatus.OK) {
        // The user's location has been found
        var userLocation = results[0].geometry.location;
    
        // Add a marker to the map at the user's location
        var marker = new google.maps.Marker({
          position: userLocation,
          map: map,
        });
    
        // Get a list of the nearest blood banks
        var bloodBanks = [
          {
            name: "Blood Bank 1",
            address: "123 Main Street, Anytown, CA 91234",
            phone: "(555) 555-5555",
          },
          {
            name: "Blood Bank 2",
            address: "456 Elm Street, Anytown, CA 91234",
            phone: "(555) 555-5556",
          },
        ];
    
        // Add a marker to the map for each blood bank
        for (var i = 0; i < bloodBanks.length; i++) {
          var bloodBank = bloodBanks[i];
          var marker = new google.maps.Marker({
            position: new google.maps.LatLng(bloodBank.latitude, bloodBank.longitude),
            map: map,
            title: bloodBank.name,
            infoWindow: new google.maps.InfoWindow({
              content: bloodBank.address + "<br>" + bloodBank.phone,
            }),
          });
    
          // When a marker is clicked, show its info window
          marker.addListener("click", function() {
            this.infoWindow.open(map, this);
          });
        }
      } else {
        // The user's location could not be found
        alert("Your location could not be found.");
      }
    });
    
    // Get the list of the nearest blood banks
    var bloodBanksNearMe = google.maps.places.nearbySearch({
      location: userLocation,
      radius: 10000,
      type: ['hospital']
    });
    
    // Add a marker for each blood bank near the user
    bloodBanksNearMe.addListener('places_changed', function() {
      for (var i = 0; i < bloodBanksNearMe.getPlaces().length; i++) {
        var bloodBank = bloodBanksNearMe.getPlaces()[i];
        var marker = new google.maps.Marker({
          position: bloodBank.geometry.location,
          map: map,
          title: bloodBank.name,
          infoWindow: new google.maps.InfoWindow({
            content: bloodBank.formatted_address,
          }),
        });
    
        // When a marker is clicked, show its info window
        marker.addListener("click", function() {
          this.infoWindow.open(map, this);
        });
      }
    });
    </script> -->
    <script>
        function initMap() {
            const cep = "57245321"; // Irá obter o CEP cadastrado no perfil do usuário

            const geocoder = new google.maps.Geocoder();
            geocoder.geocode({ address: cep }, function(results, status) {
                if (status === google.maps.GeocoderStatus.OK && results.length > 0) {
                    const userLocation = {
                        lat: results[0].geometry.location.lat(),
                        lng: results[0].geometry.location.lng()
                    };

                    const mapOptions = {
                        center: userLocation,
                        zoom: 12
                    };

                    const map = new google.maps.Map(document.getElementById('map'), mapOptions);

                    new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Seu CEP'
                    });

                    const service = new google.maps.places.PlacesService(map);
                    service.nearbySearch({
                        location: userLocation,
                        radius: 10000, // Raio de busca em metros (exemplo: 10000 metros = 10 km)
                        type: 'hospital', // Filtra os resultados para locais do tipo hospital (hemocentros)
                        keyword: 'hemocentro' // Palavra-chave para a busca (hemocentro)
                    }, processResults);

                    function processResults(results, status) {
                        if (status === google.maps.places.PlacesServiceStatus.OK) {
                            for (let i = 0; i < results.length; i++) {
                                // Adicionar marcadores para cada hemocentro encontrado
                                new google.maps.Marker({
                                    position: results[i].geometry.location,
                                    map: map,
                                    title: results[i].name
                                });
                            }
                        } else {
                            console.log('Nenhum hemocentro encontrado.');
                        }
                    }
                } else {
                    console.log('CEP não encontrado.');
                }
            });
        }
    </script>
    <script>
        // This code will get the user's location and show a map of the nearest blood banks
        var map = new google.maps.Map(document.getElementById("map"), {
          center: new google.maps.LatLng(-4.845008, -37.801109),
          zoom: 13,
        });
        
        // Get the user's location
        var geocoder = new google.maps.Geocoder();
        geocoder.geocode({
          address: "57245321",
        }, function(results, status) {
          if (status === google.maps.GeocoderStatus.OK) {
            // The user's location has been found
            var userLocation = results[0].geometry.location;
        
            // Add a marker to the map at the user's location
            var marker = new google.maps.Marker({
              position: userLocation,
              map: map,
            });
        
            // Get a list of the nearest blood banks
            var bloodBanks = [
              {
                name: "Hemocentro de Natal",
                address: "Av. Sen. Salgado Filho, 2400, Lagoa Nova, Natal - RN, 59056-200",
                phone: "(84) 3232-6178",
              },
              {
                name: "Hemocentro Regional do Seridó",
                address: "Av. Alberto Maranhão, 55, Centro, Caicó - RN, 59300-000",
                phone: "(84) 3421-2323",
              },
            ];
        
            // Add a marker to the map for each blood bank
            for (var i = 0; i < bloodBanks.length; i++) {
              var bloodBank = bloodBanks[i];
              var marker = new google.maps.Marker({
                position: new google.maps.LatLng(bloodBank.latitude, bloodBank.longitude),
                map: map,
                title: bloodBank.name,
                infoWindow: new google.maps.InfoWindow({
                  content: bloodBank.address + "<br>" + bloodBank.phone,
                }),
              });
        
              // When a marker is clicked, show its info window
              marker.addListener("click", function() {
                this.infoWindow.open(map, this);
              });
            }
          } else {
            // The user's location could not be found
            alert("Your location could not be found.");
          }
        });
        
        // Get the list of the nearest blood banks
        var bloodBanksNearMe = google.maps.places.nearbySearch({
          location: userLocation,
          radius: 10000,
          type: ['hospital']
        });
        
        // Add a marker for each blood bank near the user
        bloodBanksNearMe.addListener('places_changed', function() {
          for (var i = 0; i < bloodBanksNearMe.getPlaces().length; i++) {
            var bloodBank = bloodBanksNearMe.getPlaces()[i];
            var marker = new google.maps.Marker({
              position: bloodBank.geometry.location,
              map: map,
              title: bloodBank.name,
              infoWindow: new google.maps.InfoWindow({
                content: bloodBank.formatted_address,
              }),
            });
        
            // When a marker is clicked, show its info window
            marker.addListener("click", function() {
              this.infoWindow.open(map, this);
            });
          }
        });
        </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAfDT48kuTU7b4xrHhlg6F77BM4V_ix7w8&callback=initMap"></script>
</html>
